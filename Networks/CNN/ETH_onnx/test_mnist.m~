lgraph = importONNXLayers('mnist_0.1.onnx', ...
'OutputLayerType','classification', ...
'ImportWeights',true)
net=CNN.parse(lgraph,'cnn_mnist1');
Image=csvread('mnist_test.csv');
Labels=Image(:,1);
Labels=Labels+1;
Image=Image(:,2:785);
Image=Image/255;
mean_data = 0.1307;
std_data = 0.3018;
Image=(Image-mean_data)/std_data;

for i=1:100
im=Image(i,:);
im=reshape(im,28,28);
Y=net.evaluate(im');
[~,pred(i)]=max(Y);
end
sum(pred==Labels)

h=output_shape_max(1);
                w=output_shape_max(2);
                c=output_shape_max(3);
                m = zeros(h*w*c, h*w*c);
                column = 1;
                for k=0:h*w-1
                    for j=0:c-1
                        m(k+j*h*w+1, column) = 1;
                        column = column+1;

                    end
                end
                W=m'\W;
                
  
for i=1:100
W_3d(i,:,:,:)=reshape(W(i,:),7,7,64);
end
W_3d1=permute(W_3d,[1,3,2,4]);
for i=1:100
W1(i,:)=reshape(W_3d1(i,:,:,:),3136,1);
end
net.Layers{1, 6}.Weights=W1;